---
title: styled-components Media Queries
tags: ["React", "styled-components"]
date: 2020-08-15
author: Paul Scanlon
featuredImageUrl: https://res.cloudinary.com/www-paulie-dev/image/upload/v1597317861/paulie.dev/2020/08/styled-components-media-queries_cdk5xh.jpg
isPrivate: true
---

In this post I'm going to discuss a new approach I've started using when building Design Systems / Component Libraries with styled-components. The approach I use when building Component Libraries differs somewhat from how you might think about "styling" your application or site.

The main reason is a Design System or Component Library isn't an application or site

A Component Library is likely to be bundled and then distributed via npm and the developers / engineers (implementors) won't have access to the src code and can't modify styles unless you build this functionality into the component. This is key to ensuring brand consistency across a multitude of web entities and precisely why Component Libraries are a key part of an engineering workflow for a company who has more than a single instance of their brand online.

My take on this is:

> A crucial requirement when building Component Libraries is to permit flexibility while still maintaining control.

For example if you've developed a `<Button />` component you might want to expose some props that will allow implementors to modify it in some way. A typical example of this might be to expose a `variant` prop.

eg:

```javascript
<Button variant="secondary">Click Me</Button>
```

Under the hood your Component Library code will interpret this `prop` and then modify the styles accordingly, for example by changing the `background-color` of the button.

Whilst this is a sensible approach it can sometimes lead to **propageddon**. Depending on the requirements you might need to expose lots of props, moreover add `prop-types` or `typescript` to the mix you'll also need to type these props. Do you type them as `string` or do you type them in accordance with whatever those CSS properties values could be?

eg:

```javascript
<Button
  variant="secondary"
  size="large"
  width="100%"
  display="flex"
  flexDirection="row-reverse"
  alignItems="center"
>
  Click Me
</Button>
```

To combat this problem using `styled-components` you _could_ expose the CSS prop

eg:

```javascript
<Button
  variant="secondary"
  css={{
    width: "100%",
    display: "flex",
    flexDirection: "row-reverse",
    alignItems: "center",
  }}
>
  Click Me
</Button>
```

This would save you having to guess which props might be required by the implementors and you won't need to type anything as it's just good old CSS

But....

It's only a matter of time before someone does this which breaks the brand consistency guidelines and negates the point of having a Component Library in the first place. ðŸ˜¡ Nightmare!

eg:

```javascript
<Button variant="secondary" css={{ transform: "rotate(20deg)" }}>
  Click Me
</Button>
```

Over the years I've learnt that a simplified api for components is best, don't expose CSS and try to avoid **propageddon**

But my latest issue, and what this post is about is how to use `@media` via a prop.

To give you some more context and using the `<Button />` component again as an example I'll discuss the `width` prop

```javascript
<Button width="100%">Click Me</Button>
```

This will work so long as under the hood you're correctly passing the value of `width` on to the styled component.

eg:

```javascript
...
import styled from 'styled-components'

export const Button = styled.button({
...

}, ({ width }) => ({
  width: width
}))

```

Before we go too much further you'll notice I'm using the _style object_ syntax here. The last time I checked this approach isn't mentioned in the [docs](https://styled-components.com/docs/basics#getting-started)

To help you better understand the _style object_ approach I've prepared a short post with some common usage examples: [styled-components Style Objects](/posts/2020/08/styled-components-style-objects/)

For completeness this is what the above would look like using template literals

```javascript
...
import styled from 'styled-components'

export const Button = styled.button`
  width: ${props => props.width};
`;

```

For the rest of this post I'll be using the _style object_ syntax and my reason for using this approach is quite simple.

If I opt in to using a CSS-in-Js solution I'd personally prefer to use JavaScript syntax.

You are of course free to make up your own mind. With that out of the way let's discuss a problem we now face with the `width` prop.

Here it is again:

```javascript
<Button width="100%">Click Me</Button>
```

The width is now always set to `100%` but what if the implementors want it to be `100%` at the smallest breakpoint and `auto` on all other breakpoints?

This is where we'll need to use `@media`, but how can you pass this information on to styled-components?

Two Libraries which I'm a huge fan of do this using an array kind of syntax. Here's how it's done using [chakra](https://chakra-ui.com/responsive-styles) and the same kind of thing using [Theme UI](https://theme-ui.com/sx-prop#responsive-values)

In the case of our button we'd want it to look something like this:

```javascript
<Button width={["100%", "auto"]}>Click Me</Button>
```

By passing in an array of values we can, under the hood covert them into media queries, and that's what I'm going to talk about next.

I've recently tried this out and it appears to solve all the issues I faced but there's every chance this won't work for you and your requirements.

Here's a utility function I've created that will be used like this:

```javascript
createMediaQueries("width", ["100%", "auto"])
```

and returns this:

```javascript
{
  '@media screen and (min-width: 576px)': {
    width: "100%"
  },
  '@media screen and (min-width: 768px)': {
    width: "auto"
  }
}
```

The first argument of the function is what I've called the `CSSProperty` in the example this is the `"width"` the second argument is an array of CSS values to use with the `"width"` `CSSProperty`, I've called this arg `CSSValues`

So now let's create the function and just log out the args so we can test the function at least works with our `<Button />`

```javascript
// utils/createMediaQueries.js
export const createMediaQueries = (CSSProperty, CSSValues) => {
  console.log("CSSProperty: ", CSSProperty)
  console.log("CSSValues: ", CSSValues)
}
```

And in the component

```diff
...
import styled from 'styled-components'
import { createMediaQueries } from '../utils'

export const Button = styled.button({
...

}, ({ width }) => ({
-  width: width
+ ...createMediaQueries("width", width)
}))

```

Because we're using the _style object_ syntax we can spread the return of the `createMediaQueries` function. The `<Button />` usage still looks like this

```javascript
<Button width={["100%", "auto"]}>Click Me</Button>
```

If that works you should see a log in the browser that looks like this

```javascript
CSSProperty: width
CSSValues: (2)[("100%", "auto")]
```

Now we know the values passed in via the `width` prop get through the styled component and are passed on to the `createMediaQueries` function we can do something with them.

Back in `utils/createMediaQueries.js` let's define an array of breakpoints. You could put this array anywhere in your repo but just for demo's sake I'll add it to the top of the file.

```diff
// utils/createMediaQueries.js
+ const breakpoints = [576, 768, 992, 1200]

export const createMediaQueries = (CSSProperty, CSSValues) => {
  console.log("CSSProperty: ", CSSProperty)
  console.log("CSSValues: ", CSSValues)
}
```

The aim now is to iterate over the breakpoints array and create a new media query for each entry, and to each one we're going to add the `CSSValues` passed in via the function to the `CSSProperty` also passed in via the function.

```diff
// utils/createMediaQueries.js
const breakpoints = [576, 768, 992, 1200]

export const createMediaQueries = (CSSProperty, CSSValues) => {
  console.log("CSSProperty: ", CSSProperty)
  console.log("CSSValues: ", CSSValues)

+  const CSSMediaQueries = CSSValues
+    .filter((_, index: number) => breakpoints[index])
+    .map((value: any, index: number) => {
+      return {
+        [`@media screen and (min-width: ${breakpoints[index]}px)`]: {},
+      }
+    })

}
```

First I filter out any `CSSValues` that are not value indexes of the breakpoints array.

I'll explain: The breakpoints array has x4 values. This is the maximum amount of media queries we're going to create. But, if for example x5 `CSSValues` are passed in, in this case "25%" we can't apply it to a breakpoint because, there's only x4 breakpoints... clear as mud?

```javascript
<Button width={["100%", "auto", "50%", "33%", "25%"]}>Click Me</Button>
```

Next I use `.map` to iterate over the breakpoints array and return a media query using the correct breakpoint value as the `min-width`.

eg:

```javascript
  '@media screen and (min-width: 576px)': {},
```

This gets us some of the way there, but as you know `.map` returns an array. We can't use an array in the _style object_ syntax. But we can use an object in the _style object_ syntax. ðŸ˜

Have a breather here because next up is our old chum `.reduce`

```diff
// utils/createMediaQueries.js
const breakpoints = [576, 768, 992, 1200]

export const createMediaQueries = (CSSProperty, CSSValues) => {
  console.log("CSSProperty: ", CSSProperty)
  console.log("CSSValues: ", CSSValues)

 const CSSMediaQueries = CSSValues
    .filter((_, index: number) => breakpoints[index])
    .map((value: any, index: number) => {
      return {
        [`@media screen and (min-width: ${breakpoints[index]}px)`]: {},
      }
    })
+   .reduce((items, item, index) => {
+     items[`${Object.keys(item)}`] = {
+       [`${CSSProperty}`]: CSSValues[index],
+     }
+     return items
+   }, {})
}
```

Using `.reduce` we iterate over the array returned by `.map` and create a new object and name it by using the name of media query. It's weird I know but bear with me.

This will actually be the name of the object: `'@media screen and (min-width: 576px)'` and into this object we're going to "inject" the `CSSProperty` passed in via the function, eg: `width` and assign it the correct value from the `CSSValues` array, eg on the first iteration it'll be "100%" because that's the first item in the `width` array defined by the `width` prop.

This _should_ return the object I mentioned above:

```javascript
{
  '@media screen and (min-width: 576px)': {
    width: "100%"
  },
  '@media screen and (min-width: 768px)': {
    width: "auto"
  }
}
```

There's another little thing I wanted to check for, `CSSValues` might not be an array, it could be just a string when passed in like this:

```javascript
<Button width="100%">Click Me</Button>
```

In which case we should check if `CSSValues` is an array, if it is then `.map/.reduce` if it's not then don't attempt to create any media queries

```diff
// utils/createMediaQueries.js
const breakpoints = [576, 768, 992, 1200]

export const createMediaQueries = (CSSProperty, CSSValues) => {
  console.log("CSSProperty: ", CSSProperty)
  console.log("CSSValues: ", CSSValues)

- const CSSMediaQueries = CSSValues
+ const CSSMediaQueries = Array.isArray(CSSValues) ? CSSValues
    .filter((_, index: number) => breakpoints[index])
    .map((value: any, index: number) => {
      return {
        [`@media screen and (min-width: ${breakpoints[index]}px)`]: {},
      }
    })
   .reduce((items, item, index) => {
     items[`${Object.keys(item)}`] = {
       [`${CSSProperty}`]: CSSValues[index],
     }
     return items
   }, {})
+  : null
}
```

The final part is to return either just CSS or the CSS from the `CSSValues` 0 index and with the `CSSMediaQueries`. returning the `CSSValues` 0 index will ensure that below the minium breakpoint the width is still set to "100%"

```diff
// utils/createMediaQueries.js
const breakpoints = [576, 768, 992, 1200]

export const createMediaQueries = (CSSProperty, CSSValues) => {
  console.log("CSSProperty: ", CSSProperty)
  console.log("CSSValues: ", CSSValues)

 const CSSMediaQueries = Array.isArray(CSSValues) ? CSSValues
    .filter((_, index: number) => breakpoints[index])
    .map((value: any, index: number) => {
      return {
        [`@media screen and (min-width: ${breakpoints[index]}px)`]: {},
      }
    })
   .reduce((items, item, index) => {
     items[`${Object.keys(item)}`] = {
       [`${CSSProperty}`]: CSSValues[index],
     }
     return items
   }, {})
  : null

+  return Array.isArray(CSSValues)
+    ? {
+        [`${CSSProperty}`]: CSSValues[0],
+        ...CSSMediaQueries,
+      }
+    : {
+        [`${CSSProperty}`]: CSSValues,
+      }
}
```

... and here's the complete function, how the function is used in styled-components _style object_ syntax and a usage example:

#### Function

```javascript
// utils/createMediaQueries.js
const breakpoints = [576, 768, 992, 1200]

export const createMediaQueries = (CSSProperty, CSSValues) => {
  const CSSMediaQueries = Array.isArray(CSSValues)
    ? CSSValues.filter((_, index: number) => breakpoints[index])
        .map((value: any, index: number) => {
          return {
            [`@media screen and (min-width: ${breakpoints[index]}px)`]: {},
          }
        })
        .reduce((items, item, index) => {
          items[`${Object.keys(item)}`] = {
            [`${CSSProperty}`]: CSSValues[index],
          }
          return items
        }, {})
    : null

  return Array.isArray(CSSValues)
    ? {
        [`${CSSProperty}`]: CSSValues[0],
        ...CSSMediaQueries,
      }
    : {
        [`${CSSProperty}`]: CSSValues,
      }
}
```

<Divider />

#### Component

```javascript
// components/button.js
...
import styled from 'styled-components'
import { createMediaQueries } from '../utils'

export const Button = styled.button({
...
}, ({ width }) => ({
 ...createMediaQueries("width", width)
}))

```

<Divider />

#### Usage

```javascript
// app.js
<Button width={["100%", "auto", "50%", "33%"]}>Click Me</Button>
```
