---
title: Gatsby Cloud is your good friend
tags:
  ["React", "Gatsby", "Gatsby Cloud", "Gatsby Themes", "Shopify", "Theme UI"]
date: 2020-07-25
author: Paul Scanlon
featuredImage: gatsby-cloud-is-your-good-friend.jpg
---

If you're a Gatsby enthusiast, like me, you're probably aware of [Gatsby Cloud](https://www.gatsbyjs.org/blog/2019-11-14-announcing-gatsby-cloud/), but W T Flip actually is Gatsby Cloud and why would you choose to make it part of your workflow?

Well it depends. If like me you have a [blog](https://paulie.dev/) and each and every time you make changes (be it changes to the code or changes to the content), you push the changes to a remote repository and your hosting provider takes care of the rest. However, as my blog has grown I have been noticing an increase in time it takes to build.

I host my blog on Netlify and I get 300 free build minutes a month. Each time Netlify builds my site some of these free build minutes are used.

This isn't so much of a problem for me, each build takes 2 or 3 minutes and I only update it every once in a while but if you're making changes more regularly, either to the code or to content via a Content Management System (CMS) it won't be long before you you've used up your free minutes and this is where things can become expense.

The "time to build" issue is an inherent problem with Server Side Rendering (SSR) and it's precisely here where Gatsby Cloud can help. If you're not familiar with the concepts of SSR here's a good article by [Log Rocket](https://logrocket.com/): [Why you should render React on the server side](https://blog.logrocket.com/why-you-should-render-react-on-the-server-side-a50507163b79/)

Gatsby invented [incremental-builds](https://www.gatsbyjs.org/blog/2020-04-22-announcing-incremental-builds/) to solve this very problem and **only** Gatsby Cloud can re-build the parts of your Gatsby site that have changed since it was last updated (Michelle is that correct?) meaning you'll significantly reduce "time to build" and most likely significantly reduce hosting costs.

This is a little difficult to grasp at first so here's two fictional scenarios which might help you better understand the problem.

### The Analogy

#### Scenario A

You've popped out to buy some milk and on the way home you bump into a friend. You might say _"Hi friend, what have you been up to?"_, your friend responds by explaining _everything_ that has even happened in their life from the moment they were born right up until the moment where you said _"Hi friend..."_. This process was so lengthy your milk has soured and you're left questioning why this person is your friend, you return home thinking what a bad friend.

#### Scenario B

You've popped out to buy some milk and on the way home you bump into a friend. You might say _"Hi friend, what have you been up to?"_, your friend responds by explaining _only_ the things that have happened between the last time they saw you right up to the moment where you said _"Hi friend..."_. The duration of this conversation was a fleeting moment in time, your milk is still chilled and you return home thinking what a good friend.

In the world of SSR, Gatsby Cloud is **your** good friend!

Below is a simple yet typical workflow highlighting where Gatsby Cloud fits in to the mix. Workflow A being "the bad friend" and workflow B "the good friend"

#### Workflow A

> Code -> GitHub || CMS -> Netlify -> Live Website

In this scenario developers change the code, push the code to remote repository or CMS content changes which notifies Netlify which re-builds _everything_ before the static files are deployed and the website updates

#### Workflow B

> Code -> GitHub || CMS -> Gatsby Cloud -> Netlify -> Live website

In this scenario developers change the code, push the code to remote repository or CMS content changes which notifies Gatsby Cloud which re-builds _only_ the bits that have changed before pushing the static files on to Netlify to deploy and the website updates.

As mentioned above I get 300 free minutes of Netlify build time and in Workflow B I'd use exactly 0 of those build minutes because Gatsby Cloud is now taking responsibly for building the site. Netlify is now only used to host the site.

Gatsby Cloud naturally comes at a cost but given it's main selling point is to reduce "time to build" I'm lead to believe the reoccurring cost comparison will be much more favorable.

In addition to incremental builds a new feature that's just surfaced in Gatsby Cloud is "multi-site" builds. This is a smart way for Gatsby Cloud to take responsibility for multiple sites all from the same repo. If you're not familiar with the concept of _monorepos_ here's a good article by [Yarn](https://classic.yarnpkg.com/en/): [Workspaces in Yarn](https://classic.yarnpkg.com/blog/2017/08/02/introducing-workspaces/)

To help demonstrate this a little better I've created a fictional company with a fictional but potentially very real set of business requirements and I hope to explain how Gatsby Cloud can fit in with my business model.

### The Demo

Apple store is an E-commerce platform where customers can buy Apples. Apple store is international and requires a US Store and a UK Store.

Each store is powered by it's own [Shopify](https://www.shopify.com/) storefront and from here my team of Apple merchants independently update their respective storefronts to promote and sell Apples on both sides of the Atlantic. Our products change regularly and items go in and out of stock many times a day and it's important our sites reflect the current stock levels in almost real time.

Here's some preview links

- [UK Store](https://gatsby-apple-store-uk.netlify.app/)
- [US Store](https://gatsby-apple-store-us.netlify.app/)
- [Style Guide](https://gatsby-apple-store-style-guide.netlify.app/)

...and here's the code repository

- [GitHub Repo](https://github.com/PaulieScanlon/gatsby-apple-store)

You'll notice it's a [monorepo](https://en.wikipedia.org/wiki/Monorepo) which among other reasons allows me to manage the code for both Stores and the Style Guide all from the same place.

I'll quickly explain this setup before elaborating on how I've used Gatsby Cloud to manage the builds and deployment of multiple sites all from the **one** monorepo.

> apple-store-theme -> apple-store-core || gatsby-source-shopify -> apple-store-uk

> apple-store-theme -> apple-store-core || gatsby-source-shopify -> apple-store-us

> apple-store-theme -> style-guide

Both the Stores and the Style Guide are powered by a [Gatsby Theme](https://www.gatsbyjs.org/blog/2019-07-03-announcing-stable-release-gatsby-themes/), this can be located in the repo in `apple-store-theme`. The Theme is underpinned by [Theme UI](https://theme-ui.com/) which, if you haven't used before you really should because it's super brill brills. This Theme is responsible for how things look. Theme UI ships with a number of UI components which should pretty much allow you to compose anything you like. The Style Guide simply renders all the Theme UI components on one page along with presenting styles for Markdown should you wish to use it.

The Stores also use another Theme, `apple-store-core`. This Theme is responsible for composing the styled Theme UI components to make the features used in the Stores and utilizes the [gatsby-source-shopify](https://github.com/gatsbyjs/gatsby/tree/master/packages/gatsby-source-shopify) plugin to fetch data from each of the Shopify storefront APIs at build time.

As mentioned above, both the Stores, the Style Guide and the two Themes all live in the **one** repo, but we don't want to build and deploy everything in the repo. Luckily for us Gatsby has already thought about this and we can easily let Gatsby Cloud know which of these sub-repos it should be responsible for.

> Gatsby Cloud Base Repo -> apple-store-uk

> Gatsby Cloud Base Repo -> apple-store-us

> Gatsby Cloud Base Repo -> style-guide

> Gatsby Cloud Ignore -> apple-store-theme

> Gatsby Cloud Ignore -> apple-store-core

When you start with Gatsby Cloud you'll be met with the familiar "Add Site" button, this as it suggests allows you to add a site. When you've authorized and connected Gatsby Cloud with your GitHub account you'll be able to select a repo which Gatsby Cloud will build from.

... needs a bit of work

You'll also notice there's a "base repo" option. This is where you can select which subdirectory from your monorepo to build.

If you repeat this step for each of the subdirectories in your monorepo you'll have a neat looking setup up like this.

> image of my Gatsby Cloud

With the sub-repos from the monorepo setup Gatsby Cloud will re-build whenever a push is detected from GitHub.

### But wait there's more.

Since both the Stores are powered by Shopify we'll also need to let Gatsby Cloud know that re-builds are required as and when a change occurs in the Stores Shopfiy storefront account. This can be achieved using a "build hook"

> image of Gatsby Cloud site settings build hook

In both cases when code is pushed by developers to GitHub or when anything in the Shopify storefront account changes Gatsby Cloud will _only_ update the site that has changed **and** will _only_ update the parts of that site that have changed. Blazing fast indeed!

I've been developing Apple Store for the last two weeks and even during development I've noticed a big difference in "time to build", in some cases I'm seeing the store update in less than 10 seconds... which is mind blowing!

Naturally I don't know about every possible business model and their requirements but it's a fair assumption that build hooks and regular re-builds are required for all manner of business and if you're looking to create blazing fast sites using SSR Gatsby Cloud is the perfect accompaniment.

And that's it, see ya friends ✌️
